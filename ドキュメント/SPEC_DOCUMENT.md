# AI Auto Video Generator - 仕様書

## プロジェクト識別情報

- **プロジェクト名**: AI Auto Video Generator
- **バージョン**: 0.2.0
- **作成日**: 2025-12-31
- **最終更新**: 2025-12-31

---

## 1. プロジェクト概要

### 1.1 目的

ユーザーがアップロードした複数の画像と音源を、AI が分析し、音楽のリズム・ムードに合わせて最適な順序・タイミング・トランジションで自動的に動画を生成する Web アプリケーション。

### 1.2 コンセプト

「誰でも簡単に、プロ品質のミュージックビデオ風動画を作成できる」

### 1.3 ターゲットユーザー

- SNS 投稿用の短尺動画を作りたい一般ユーザー
- 動画編集の知識がないが印象的な動画を作りたい人
- 大量の写真を音楽に合わせてスライドショー化したい人

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 画像アップロード機能

| 項目             | 仕様                                 |
| ---------------- | ------------------------------------ |
| 対応形式         | JPEG, PNG, WebP, GIF（静止画として） |
| 枚数制限         | 無制限（推奨: 5〜50 枚）             |
| ファイルサイズ   | 1 枚あたり最大 20MB                  |
| アップロード方式 | ドラッグ&ドロップ / ファイル選択     |
| プレビュー       | サムネイル一覧表示、並び替え可能     |

#### 2.1.2 音源アップロード機能

| 項目           | 仕様                            |
| -------------- | ------------------------------- |
| 対応形式       | MP3, WAV, AAC, OGG              |
| ファイルサイズ | 最大 50MB                       |
| 長さ制限       | 最大 10 分（推奨: 30 秒〜3 分） |
| プレビュー     | 波形表示、再生プレイヤー        |

#### 2.1.3 AI 画像分析機能

Claude API を使用して各画像を分析し、以下の情報を抽出：

```json
{
  "imageId": "unique-id",
  "analysis": {
    "scene": "屋外/室内/自然/都市/抽象など",
    "mood": "明るい/暗い/ノスタルジック/エネルギッシュなど",
    "genre": "風景/ポートレート/食べ物/アート/イベントなど",
    "dominantColors": ["#RRGGBB", ...],
    "visualIntensity": 1-10,
    "suggestedDuration": "short/medium/long",
    "motionSuggestion": "static/zoom-in/zoom-out/pan",
    "tags": ["sunset", "beach", "romantic", ...]
  }
}
```

#### 2.1.4 AI 音源分析機能

Web Audio API + Claude API を使用して音源を分析：

```json
{
  "audioId": "unique-id",
  "analysis": {
    "bpm": 120,
    "genre": "pop/rock/electronic/classical/ambient/etc",
    "mood": "upbeat/melancholic/intense/calm",
    "energy": 1-10,
    "beats": [
      { "time": 0.5, "strength": "strong" },
      { "time": 1.0, "strength": "weak" },
      ...
    ],
    "sections": [
      { "start": 0, "end": 15, "type": "intro", "energy": 3 },
      { "start": 15, "end": 45, "type": "verse", "energy": 5 },
      { "start": 45, "end": 60, "type": "chorus", "energy": 8 },
      ...
    ],
    "highlights": [
      { "time": 45.2, "type": "drop", "intensity": 10 },
      { "time": 78.5, "type": "climax", "intensity": 9 },
      ...
    ]
  }
}
```

#### 2.1.5 自動編集ロジック

AI が画像と音源の分析結果を統合し、最適な動画構成を決定：

**マッチングルール:**

- 音楽のビート位置で画像を切り替え
- セクションのエネルギーレベルに合った画像を配置
  - 高エネルギー → visualIntensity が高い画像
  - 低エネルギー → 落ち着いた画像
- ハイライト（ドロップ・クライマックス）には最もインパクトのある画像を配置
- 色の連続性を考慮（急激な色変化を避ける or 意図的に使う）

#### 2.1.6 トランジション自動選択

ジャンル・ムードに応じたトランジションマッピング：

| 音楽ジャンル/ムード | 推奨トランジション               |
| ------------------- | -------------------------------- |
| Electronic/Intense  | カット、グリッチ、フラッシュ     |
| Pop/Upbeat          | クロスフェード、スライド、ズーム |
| Classical/Calm      | ゆっくりフェード、ディゾルブ     |
| Rock/Energetic      | ワイプ、プッシュ、カット         |
| Ambient/Dreamy      | ブラー、モーフ、長めのフェード   |

ビートの強さに応じて：

- 強いビート → 瞬間的なカット or フラッシュ
- 弱いビート → クロスフェード

**トランジション拡張設計:**
トランジションは設定ファイル（`transitionConfig.js`）で定義し、後から容易に追加可能な構造とする。

```javascript
// transitionConfig.js の構造例
export const transitions = {
  fade: { name: 'フェード', duration: [0.3, 1.0], compatible: ['all'] },
  cut: { name: 'カット', duration: [0], compatible: ['energetic', 'intense'] },
  slide: { name: 'スライド', direction: ['left', 'right', 'up', 'down'], ... },
  // 新規追加時はここに定義を追加するだけ
};
```

#### 2.1.7 ケンバーンズ効果（モーションエフェクト）

静止画に動きを加え、映像的な魅力を向上させる機能。

| エフェクト名 | 説明                         | 適用シーン                     |
| ------------ | ---------------------------- | ------------------------------ |
| Zoom In      | 中心に向かってゆっくりズーム | ポートレート、注目させたい対象 |
| Zoom Out     | 引きながら全体を見せる       | 風景、グループ写真             |
| Pan Left     | 左から右へ移動               | 横長の風景、パノラマ           |
| Pan Right    | 右から左へ移動               | 横長の風景、パノラマ           |
| Pan Up       | 下から上へ移動               | 縦長の建物、人物               |
| Pan Down     | 上から下へ移動               | 縦長の建物、人物               |
| Zoom + Pan   | ズームしながらパン           | ダイナミックな演出             |
| Static       | 動きなし                     | 意図的な静止、対比効果         |

**自動選択ロジック:**

```
画像分析結果に基づいて自動決定:
- ポートレート検出 → Zoom In（顔にフォーカス）
- 風景・広角 → Zoom Out または Pan
- visualIntensity高 → 動き控えめ（Static or 微Zoom）
- visualIntensity低 → 動き大きめ（目を引く効果）
- 音楽エネルギー高 → 速い動き
- 音楽エネルギー低 → ゆっくりした動き
```

**モーション強度設定:**

```json
{
  "motion": {
    "type": "zoom-in",
    "intensity": 0.15, // 0.05（微小）〜 0.3（大きい）
    "easing": "ease-out" // linear, ease-in, ease-out, ease-in-out
  }
}
```

### 2.2 出力機能

| 項目           | 仕様                       |
| -------------- | -------------------------- |
| 出力形式       | MP4 (H.264)                |
| フレームレート | 30fps / 60fps              |
| プレビュー     | リアルタイムプレビュー再生 |

#### アスペクト比オプション

| プリセット名           | アスペクト比 | 解像度    | 用途                         |
| ---------------------- | ------------ | --------- | ---------------------------- |
| YouTube / 標準         | 16:9         | 1920×1080 | YouTube、一般的な動画        |
| Instagram 投稿         | 1:1          | 1080×1080 | Instagram フィード（正方形） |
| Instagram 投稿（縦長） | 4:5          | 1080×1350 | Instagram フィード（推奨）   |
| Instagram リール       | 9:16         | 1080×1920 | リール、TikTok               |
| Instagram ストーリーズ | 9:16         | 1080×1920 | ストーリーズ                 |

#### 動画の長さ設定

| 項目     | 仕様                               |
| -------- | ---------------------------------- |
| 設定方法 | ユーザーが自由に指定               |
| 最小長さ | 1 秒                               |
| 最大長さ | 音源の長さまで                     |
| 入力方式 | スライダー + 数値入力              |
| 範囲選択 | 音源の開始位置・終了位置を指定可能 |

```
音源タイムライン:
|▼開始─────────────────────▼終了|
0:00    0:30    1:00    1:30    2:00
        [====選択範囲====]
        　　  30秒の動画
```

### 2.3 ユーザー調整機能（オプション）

- 画像の手動並び替え
- 特定画像の表示時間調整
- トランジション種類の手動変更
- ビート検出感度の調整

---

## 3. 技術スタック

### 3.1 フロントエンド

```
- React 18+ (JSX)
- Tailwind CSS
- Web Audio API（音源分析）
- Canvas API / WebGL（プレビュー描画）
- FFmpeg.wasm（動画エンコード）
```

### 3.2 AI/API

```
- Claude API (claude-sonnet-4-20250514)
  - 画像分析
  - 音源メタデータ分析
  - 編集ロジック最適化
- Meyda.js（音響特徴量抽出）
```

### 3.3 主要ライブラリ

```
- @ffmpeg/ffmpeg: 動画エンコード
- wavesurfer.js: 波形表示
- meyda: 音響分析
- react-dropzone: ファイルアップロード
- uuid: 一意ID生成
```

---

## 4. システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                      ユーザーインターフェース                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 画像アップロード │  │ 音源アップロード │  │  プレビュー/出力    │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
└─────────┼────────────────┼───────────────────┼──────────────┘
          │                │                   │
          ▼                ▼                   │
┌─────────────────────────────────────────────┐│
│              分析エンジン                     ││
│  ┌─────────────┐  ┌─────────────────────┐   ││
│  │ 画像分析     │  │ 音源分析             │   ││
│  │ (Claude API) │  │ (Web Audio + Claude) │   ││
│  └──────┬──────┘  └──────────┬──────────┘   ││
│         │                    │              ││
│         ▼                    ▼              ││
│  ┌──────────────────────────────────────┐   ││
│  │        AI編集エンジン                  │   ││
│  │  - 画像-音楽マッチング                 │   ││
│  │  - タイムライン生成                   │   ││
│  │  - トランジション決定                 │   ││
│  └──────────────────┬───────────────────┘   ││
└─────────────────────┼───────────────────────┘│
                      │                        │
                      ▼                        │
┌─────────────────────────────────────────────┐│
│           レンダリングエンジン                 │◄┘
│  ┌─────────────────────────────────────┐    │
│  │ Canvas/WebGL プレビュー              │    │
│  └─────────────────────────────────────┘    │
│  ┌─────────────────────────────────────┐    │
│  │ FFmpeg.wasm 動画出力                 │    │
│  └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

---

## 5. データフロー

### 5.1 処理フロー

```
1. ユーザー操作
   └─> 画像アップロード（複数）
   └─> 音源アップロード（1ファイル）

2. 分析フェーズ（並列処理）
   ├─> 各画像をClaude APIで分析
   └─> 音源をWeb Audio API + Meydaで分析
       └─> 分析結果をClaude APIで解釈

3. 編集計画フェーズ
   └─> Claude APIに全分析結果を送信
       └─> 最適なタイムライン構成を生成

4. プレビューフェーズ
   └─> Canvas/WebGLでリアルタイムプレビュー
   └─> ユーザー調整を受付

5. 出力フェーズ
   └─> FFmpeg.wasmで動画エンコード
   └─> ダウンロード提供
```

### 5.2 タイムラインデータ構造

```json
{
  "timeline": {
    "duration": 120.5,
    "resolution": "1920x1080",
    "fps": 30,
    "clips": [
      {
        "imageId": "img-001",
        "startTime": 0,
        "endTime": 2.5,
        "transition": {
          "type": "fade",
          "duration": 0.3
        },
        "effects": {
          "motion": "zoom-in",
          "motionIntensity": 0.1
        }
      },
      ...
    ]
  }
}
```

---

## 6. UI/UX 設計

### 6.1 画面構成

```
┌──────────────────────────────────────────────────────────────────┐
│  ヘッダー: AI Auto Video Generator                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────┐  ┌────────────────────────────────┐ │
│  │                        │  │  コントロールパネル              │ │
│  │   プレビューエリア       │  │                                │ │
│  │   (選択した比率で表示)   │  │  📐 アスペクト比                │ │
│  │                        │  │  ┌────────────────────────┐   │ │
│  │                        │  │  │ ○ YouTube (16:9)       │   │ │
│  │   ▶ 再生ボタン          │  │  │ ○ Instagram投稿 (1:1)  │   │ │
│  │                        │  │  │ ○ Instagram投稿 (4:5)  │   │ │
│  │                        │  │  │ ○ リール/ストーリー(9:16)│   │ │
│  └────────────────────────┘  │  └────────────────────────┘   │ │
│                              │                                │ │
│                              │  🎬 FPS: [30fps ▼]             │ │
│                              │                                │ │
│                              │  [✨ 動画を生成] ボタン          │ │
│                              └────────────────────────────────┘ │
│                                                                  │
├──────────────────────────────────────────────────────────────────┤
│  音源エリア                                                       │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ 🎵 ドラッグ&ドロップ or クリックで音源をアップロード          │   │
│  │                                                          │   │
│  │ 波形表示:                                                 │   │
│  │ ┌────────────────────────────────────────────────────┐   │   │
│  │ │▼開始                                        ▼終了 │   │   │
│  │ │  ████████████████████████████████████████████████ │   │   │
│  │ │  0:00      0:30      1:00      1:30      2:00     │   │   │
│  │ └────────────────────────────────────────────────────┘   │   │
│  │                                                          │   │
│  │ 動画の長さ: [0:15] 〜 [1:45]  = 1分30秒                   │   │
│  └──────────────────────────────────────────────────────────┘   │
├──────────────────────────────────────────────────────────────────┤
│  画像エリア                                                       │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ 📷 ドラッグ&ドロップ or クリックで画像をアップロード          │   │
│  │                                                          │   │
│  │ [img1] [img2] [img3] [img4] [img5] [+追加]               │   │
│  │  ↕ ドラッグで並び替え可能                                  │   │
│  └──────────────────────────────────────────────────────────┘   │
├──────────────────────────────────────────────────────────────────┤
│  タイムライン（分析後表示）                                         │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ |img1[zoom]|--fade--|img2[pan]|--cut--|img3[static]|...  │   │
│  │ ════════════════════════════════════════════════════════ │   │
│  │ 0:00        0:30        1:00        1:30                 │   │
│  └──────────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────────┘
```

### 6.2 ステータス表示

- アップロード中: プログレスバー
- 分析中: 各画像/音源の分析進捗
- 生成中: レンダリング進捗
- エラー: 明確なエラーメッセージと対処法

---

## 7. 開発フェーズ

### Phase 1: 基盤構築 (MVP)

- [ ] プロジェクトセットアップ（React + Tailwind）
- [ ] 画像アップロード UI
- [ ] 音源アップロード UI
- [ ] 基本的な波形表示

### Phase 2: 分析機能

- [ ] 画像分析（Claude API 連携）
- [ ] 音源分析（Web Audio API + Meyda）
- [ ] ビート検出アルゴリズム

### Phase 3: 編集エンジン

- [ ] AI による編集計画生成
- [ ] タイムライン構築ロジック
- [ ] トランジションマッピング

### Phase 4: レンダリング

- [ ] Canvas プレビュー実装
- [ ] FFmpeg.wasm 統合
- [ ] 動画出力機能

### Phase 5: 最適化・機能追加

- [ ] パフォーマンス最適化
- [ ] ユーザー調整機能
- [ ] UI/UX 改善

---

## 8. 制約事項・注意点

### 8.1 技術的制約

- FFmpeg.wasm はメモリ消費が大きい（長い動画は分割処理が必要）
- Claude API の画像分析は Base64 送信のためサイズ制限あり
- ブラウザのメモリ制限に注意（大量の大きな画像）

### 8.2 コスト考慮

- Claude API 呼び出し回数の最適化
  - 画像はバッチ処理で分析
  - キャッシュ活用

### 8.3 対応ブラウザ

- Chrome 90+
- Firefox 88+
- Safari 15+
- Edge 90+

---

## 9. 用語定義

| 用語           | 定義                                       |
| -------------- | ------------------------------------------ |
| ビート         | 音楽のリズムの基本単位、拍                 |
| BPM            | Beats Per Minute、1 分あたりの拍数         |
| トランジション | 画像間の切り替え効果                       |
| クリップ       | タイムライン上の 1 つの画像表示区間        |
| セクション     | 音楽の構造的な区切り（イントロ、サビなど） |
| ハイライト     | 音楽の中で特に印象的な瞬間                 |

---

## 10. チャット引き継ぎプロトコル

### 10.1 引き継ぎ時の必須情報

新しいチャットを開始する際は、以下を冒頭に貼り付けてください：

```
【プロジェクト引き継ぎ】
プロジェクト名: AI Auto Video Generator
仕様書: この文書の最新版
現在のフェーズ: Phase X
最新ソースコード: [ファイルパス一覧]
未完了タスク: [具体的なタスクリスト]
既知の問題: [バグや課題]
```

### 10.2 ソースコード管理

- メインファイル: `/home/claude/ai-video-generator/`
- 出力先: `/mnt/user-data/outputs/`

### 10.3 バージョン管理

仕様変更時は必ず以下を更新：

1. この仕様書の「バージョン」と「最終更新」
2. 変更履歴セクションに追記

---

## 11. 変更履歴

| 日付       | バージョン | 変更内容                                                                                                             |
| ---------- | ---------- | -------------------------------------------------------------------------------------------------------------------- |
| 2025-12-31 | 0.1.0      | 初版作成                                                                                                             |
| 2025-12-31 | 0.2.0      | アスペクト比オプション追加（Instagram 対応）、動画長さ選択機能追加、ケンバーンズ効果追加、トランジション拡張設計追加 |

---

## 12. 次のステップ

1. この仕様書の内容確認・調整
2. 不明点や追加要望の洗い出し
3. Phase 1 の開発開始
