# AI Auto Video Generator - 仕様書

## プロジェクト識別情報

- **プロジェクト名**: AI Auto Video Generator
- **バージョン**: 0.3.0
- **作成日**: 2025-12-31
- **最終更新**: 2025-12-31

---

## 1. プロジェクト概要

### 1.1 目的

ユーザーがアップロードした複数の画像と音源を、AI が分析し、音楽のリズム・ムードに合わせて最適な順序・タイミング・トランジションで自動的に動画を生成する Web アプリケーション。

### 1.2 コンセプト

「誰でも簡単に、プロ品質のミュージックビデオ風動画を作成できる」

### 1.3 ターゲットユーザー

- SNS 投稿用の短尺動画を作りたい一般ユーザー
- 動画編集の知識がないが印象的な動画を作りたい人
- 大量の写真を音楽に合わせてスライドショー化したい人

### 1.4 ビジネスモデル

- **提供形態**: SaaS（Web アプリ + PWA）
- **収益モデル**: サブスクリプション（月額課金）
- **想定ユーザー数**: 1,000 人
- **決済システム**: Stripe

### 1.5 料金プラン

| プラン        | 月額   | 動画生成数 | 解像度 | 最大長さ | その他                 |
| ------------- | ------ | ---------- | ------ | -------- | ---------------------- |
| **Free**      | ¥0     | 3 本/月    | 720p   | 30 秒    | ウォーターマークあり   |
| **Pro**       | ¥980   | 30 本/月   | 1080p  | 3 分     | ウォーターマークなし   |
| **Unlimited** | ¥2,980 | 無制限     | 4K     | 10 分    | 優先処理、API アクセス |

---

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 画像アップロード機能

| 項目             | 仕様                                 |
| ---------------- | ------------------------------------ |
| 対応形式         | JPEG, PNG, WebP, GIF（静止画として） |
| 枚数制限         | 無制限（推奨: 5〜50 枚）             |
| ファイルサイズ   | 1 枚あたり最大 20MB                  |
| アップロード方式 | ドラッグ&ドロップ / ファイル選択     |
| プレビュー       | サムネイル一覧表示、並び替え可能     |

#### 2.1.2 音源アップロード機能

| 項目           | 仕様                            |
| -------------- | ------------------------------- |
| 対応形式       | MP3, WAV, AAC, OGG              |
| ファイルサイズ | 最大 50MB                       |
| 長さ制限       | 最大 10 分（推奨: 30 秒〜3 分） |
| プレビュー     | 波形表示、再生プレイヤー        |

#### 2.1.3 AI 画像分析機能

Claude API を使用して各画像を分析し、以下の情報を抽出：

```json
{
  "imageId": "unique-id",
  "analysis": {
    "scene": "屋外/室内/自然/都市/抽象など",
    "mood": "明るい/暗い/ノスタルジック/エネルギッシュなど",
    "genre": "風景/ポートレート/食べ物/アート/イベントなど",
    "dominantColors": ["#RRGGBB", ...],
    "visualIntensity": 1-10,
    "suggestedDuration": "short/medium/long",
    "motionSuggestion": "static/zoom-in/zoom-out/pan",
    "tags": ["sunset", "beach", "romantic", ...]
  }
}
```

#### 2.1.4 AI 音源分析機能

Web Audio API + Claude API を使用して音源を分析：

```json
{
  "audioId": "unique-id",
  "analysis": {
    "bpm": 120,
    "genre": "pop/rock/electronic/classical/ambient/etc",
    "mood": "upbeat/melancholic/intense/calm",
    "energy": 1-10,
    "beats": [
      { "time": 0.5, "strength": "strong" },
      { "time": 1.0, "strength": "weak" },
      ...
    ],
    "sections": [
      { "start": 0, "end": 15, "type": "intro", "energy": 3 },
      { "start": 15, "end": 45, "type": "verse", "energy": 5 },
      { "start": 45, "end": 60, "type": "chorus", "energy": 8 },
      ...
    ],
    "highlights": [
      { "time": 45.2, "type": "drop", "intensity": 10 },
      { "time": 78.5, "type": "climax", "intensity": 9 },
      ...
    ]
  }
}
```

#### 2.1.5 自動編集ロジック

AI が画像と音源の分析結果を統合し、最適な動画構成を決定：

**マッチングルール:**

- 音楽のビート位置で画像を切り替え
- セクションのエネルギーレベルに合った画像を配置
  - 高エネルギー → visualIntensity が高い画像
  - 低エネルギー → 落ち着いた画像
- ハイライト（ドロップ・クライマックス）には最もインパクトのある画像を配置
- 色の連続性を考慮（急激な色変化を避ける or 意図的に使う）

#### 2.1.6 トランジション自動選択

ジャンル・ムードに応じたトランジションマッピング：

| 音楽ジャンル/ムード | 推奨トランジション               |
| ------------------- | -------------------------------- |
| Electronic/Intense  | カット、グリッチ、フラッシュ     |
| Pop/Upbeat          | クロスフェード、スライド、ズーム |
| Classical/Calm      | ゆっくりフェード、ディゾルブ     |
| Rock/Energetic      | ワイプ、プッシュ、カット         |
| Ambient/Dreamy      | ブラー、モーフ、長めのフェード   |

ビートの強さに応じて：

- 強いビート → 瞬間的なカット or フラッシュ
- 弱いビート → クロスフェード

**トランジション拡張設計:**
トランジションは設定ファイル（`transitionConfig.js`）で定義し、後から容易に追加可能な構造とする。

```javascript
// transitionConfig.js の構造例
export const transitions = {
  fade: { name: 'フェード', duration: [0.3, 1.0], compatible: ['all'] },
  cut: { name: 'カット', duration: [0], compatible: ['energetic', 'intense'] },
  slide: { name: 'スライド', direction: ['left', 'right', 'up', 'down'], ... },
  // 新規追加時はここに定義を追加するだけ
};
```

#### 2.1.7 ケンバーンズ効果（モーションエフェクト）

静止画に動きを加え、映像的な魅力を向上させる機能。

| エフェクト名 | 説明                         | 適用シーン                     |
| ------------ | ---------------------------- | ------------------------------ |
| Zoom In      | 中心に向かってゆっくりズーム | ポートレート、注目させたい対象 |
| Zoom Out     | 引きながら全体を見せる       | 風景、グループ写真             |
| Pan Left     | 左から右へ移動               | 横長の風景、パノラマ           |
| Pan Right    | 右から左へ移動               | 横長の風景、パノラマ           |
| Pan Up       | 下から上へ移動               | 縦長の建物、人物               |
| Pan Down     | 上から下へ移動               | 縦長の建物、人物               |
| Zoom + Pan   | ズームしながらパン           | ダイナミックな演出             |
| Static       | 動きなし                     | 意図的な静止、対比効果         |

**自動選択ロジック:**

```
画像分析結果に基づいて自動決定:
- ポートレート検出 → Zoom In（顔にフォーカス）
- 風景・広角 → Zoom Out または Pan
- visualIntensity高 → 動き控えめ（Static or 微Zoom）
- visualIntensity低 → 動き大きめ（目を引く効果）
- 音楽エネルギー高 → 速い動き
- 音楽エネルギー低 → ゆっくりした動き
```

**モーション強度設定:**

```json
{
  "motion": {
    "type": "zoom-in",
    "intensity": 0.15, // 0.05（微小）〜 0.3（大きい）
    "easing": "ease-out" // linear, ease-in, ease-out, ease-in-out
  }
}
```

### 2.2 出力機能

| 項目           | 仕様                       |
| -------------- | -------------------------- |
| 出力形式       | MP4 (H.264)                |
| フレームレート | 30fps / 60fps              |
| プレビュー     | リアルタイムプレビュー再生 |

#### アスペクト比オプション

| プリセット名           | アスペクト比 | 解像度    | 用途                         |
| ---------------------- | ------------ | --------- | ---------------------------- |
| YouTube / 標準         | 16:9         | 1920×1080 | YouTube、一般的な動画        |
| Instagram 投稿         | 1:1          | 1080×1080 | Instagram フィード（正方形） |
| Instagram 投稿（縦長） | 4:5          | 1080×1350 | Instagram フィード（推奨）   |
| Instagram リール       | 9:16         | 1080×1920 | リール、TikTok               |
| Instagram ストーリーズ | 9:16         | 1080×1920 | ストーリーズ                 |

#### 動画の長さ設定

| 項目     | 仕様                               |
| -------- | ---------------------------------- |
| 設定方法 | ユーザーが自由に指定               |
| 最小長さ | 1 秒                               |
| 最大長さ | 音源の長さまで                     |
| 入力方式 | スライダー + 数値入力              |
| 範囲選択 | 音源の開始位置・終了位置を指定可能 |

```
音源タイムライン:
|▼開始─────────────────────▼終了|
0:00    0:30    1:00    1:30    2:00
        [====選択範囲====]
        　　  30秒の動画
```

### 2.3 ユーザー調整機能（オプション）

- 画像の手動並び替え
- 特定画像の表示時間調整
- トランジション種類の手動変更
- ビート検出感度の調整

---

## 3. 技術スタック

### 3.1 フロントエンド

```
- Next.js 14+ (App Router)
- React 18+
- Tailwind CSS
- TypeScript
- Web Audio API（音源分析）
- Canvas API / WebGL（プレビュー描画）
- FFmpeg.wasm（動画エンコード）
- PWA対応（next-pwa）
```

### 3.2 バックエンド

```
- Next.js API Routes（サーバーレス）
- Supabase（データベース + 認証）
- Stripe（決済）
```

### 3.3 インフラ・ホスティング

```
- Vercel（フロントエンド + API）
- Supabase（PostgreSQL + Auth + Storage）
- Cloudflare R2（動画一時保存）※必要に応じて
```

### 3.4 AI/API

```
- Claude API (claude-sonnet-4-20250514)
  - 画像分析
  - 音源メタデータ分析
  - 編集ロジック最適化
- Meyda.js（音響特徴量抽出）
```

### 3.5 主要ライブラリ

```
フロントエンド:
- @ffmpeg/ffmpeg: 動画エンコード
- wavesurfer.js: 波形表示
- meyda: 音響分析
- react-dropzone: ファイルアップロード
- @dnd-kit/core: ドラッグ&ドロップ
- uuid: 一意ID生成

バックエンド/認証/決済:
- @supabase/supabase-js: DB・認証クライアント
- stripe: 決済処理
- @stripe/stripe-js: フロントエンド決済UI
```

---

## 4. システムアーキテクチャ

### 4.1 全体構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                         ユーザー                                 │
│                  (ブラウザ / PWA / スマホ)                        │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Next.js (Vercel)                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    フロントエンド                         │   │
│  │                  (React + Tailwind)                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   API Routes                             │   │
│  │  /api/auth/*      - 認証処理                             │   │
│  │  /api/analyze/*   - AI分析（Claude API中継）             │   │
│  │  /api/stripe/*    - 決済処理                             │   │
│  │  /api/usage/*     - 使用量チェック                        │   │
│  └─────────────────────────────────────────────────────────┘   │
└───────┬─────────────────┬─────────────────┬─────────────────────┘
        │                 │                 │
        ▼                 ▼                 ▼
┌─────────────┐   ┌─────────────┐   ┌─────────────┐
│  Supabase   │   │   Stripe    │   │ Claude API  │
│             │   │             │   │             │
│ - Auth      │   │ - 決済処理   │   │ - 画像分析  │
│ - Database  │   │ - サブスク   │   │ - 編集計画  │
│ - Storage   │   │   管理      │   │             │
└─────────────┘   └─────────────┘   └─────────────┘
```

### 4.2 データベース設計 (Supabase)

```sql
-- ユーザーテーブル（Supabase Auth連携）
users (
  id UUID PRIMARY KEY,          -- Supabase Auth のUID
  email TEXT,
  display_name TEXT,
  avatar_url TEXT,
  plan TEXT DEFAULT 'free',     -- free / pro / unlimited
  stripe_customer_id TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

-- 使用量テーブル
usage (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  month TEXT,                   -- '2025-01' 形式
  video_count INT DEFAULT 0,
  created_at TIMESTAMP
)

-- 生成履歴テーブル
generations (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  status TEXT,                  -- pending / processing / completed / failed
  settings JSONB,               -- アスペクト比、長さなど
  result_url TEXT,              -- 生成された動画のURL
  created_at TIMESTAMP
)

-- サブスクリプションテーブル
subscriptions (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  stripe_subscription_id TEXT,
  plan TEXT,
  status TEXT,                  -- active / canceled / past_due
  current_period_start TIMESTAMP,
  current_period_end TIMESTAMP,
  created_at TIMESTAMP
)
```

### 4.3 認証フロー

```
1. 新規登録 / ログイン
   ユーザー → Supabase Auth（メール/Google/GitHub）
         ↓
   JWT トークン発行 → フロントエンドで保持
         ↓
   API リクエスト時にトークン付与

2. プラン確認フロー
   API リクエスト
         ↓
   JWT 検証 → ユーザーID取得
         ↓
   DB でプラン・使用量確認
         ↓
   制限内なら処理実行 / 制限超過ならエラー返却
```

### 4.4 決済フロー (Stripe)

```
1. プランアップグレード
   ユーザーが「Pro にアップグレード」クリック
         ↓
   Stripe Checkout セッション作成
         ↓
   Stripe の決済ページへリダイレクト
         ↓
   決済完了 → Webhook で通知受信
         ↓
   DB の plan を更新

2. 毎月の自動課金
   Stripe が自動で課金処理
         ↓
   成功/失敗を Webhook で受信
         ↓
   失敗時は plan を 'past_due' に更新
```

### 4.5 コア機能アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                      ユーザーインターフェース                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ 画像アップロード │  │ 音源アップロード │  │  プレビュー/出力   │ │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘ │
└─────────┼────────────────┼───────────────────┼──────────────┘
          │                │                   │
          ▼                ▼                   │
┌─────────────────────────────────────────────┐│
│              分析エンジン                    ││
│  ┌─────────────┐  ┌─────────────────────┐  ││
│  │ 画像分析     │  │ 音源分析            │  ││
│  │ (API経由で   │  │ (Web Audio +       │  ││
│  │  Claude)    │  │  API経由でClaude)   │  ││
│  └──────┬──────┘  └──────────┬──────────┘  ││
│         │                    │             ││
│         ▼                    ▼             ││
│  ┌──────────────────────────────────────┐  ││
│  │        AI編集エンジン                 │  ││
│  │  - 画像-音楽マッチング                │  ││
│  │  - タイムライン生成                  │  ││
│  │  - トランジション決定                │  ││
│  └──────────────────┬───────────────────┘  ││
└─────────────────────┼──────────────────────┘│
                      │                       │
                      ▼                       │
┌─────────────────────────────────────────────┐│
│           レンダリングエンジン                │◄┘
│  ┌─────────────────────────────────────┐   │
│  │ Canvas/WebGL プレビュー             │   │
│  └─────────────────────────────────────┘   │
│  ┌─────────────────────────────────────┐   │
│  │ FFmpeg.wasm 動画出力                │   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

---

## 5. データフロー

### 5.1 処理フロー

```
1. ユーザー操作
   └─> 画像アップロード（複数）
   └─> 音源アップロード（1ファイル）

2. 分析フェーズ（並列処理）
   ├─> 各画像をClaude APIで分析
   └─> 音源をWeb Audio API + Meydaで分析
       └─> 分析結果をClaude APIで解釈

3. 編集計画フェーズ
   └─> Claude APIに全分析結果を送信
       └─> 最適なタイムライン構成を生成

4. プレビューフェーズ
   └─> Canvas/WebGLでリアルタイムプレビュー
   └─> ユーザー調整を受付

5. 出力フェーズ
   └─> FFmpeg.wasmで動画エンコード
   └─> ダウンロード提供
```

### 5.2 タイムラインデータ構造

```json
{
  "timeline": {
    "duration": 120.5,
    "resolution": "1920x1080",
    "fps": 30,
    "clips": [
      {
        "imageId": "img-001",
        "startTime": 0,
        "endTime": 2.5,
        "transition": {
          "type": "fade",
          "duration": 0.3
        },
        "effects": {
          "motion": "zoom-in",
          "motionIntensity": 0.1
        }
      },
      ...
    ]
  }
}
```

---

## 6. UI/UX 設計

### 6.1 画面構成

```
┌──────────────────────────────────────────────────────────────────┐
│  ヘッダー: AI Auto Video Generator                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────┐  ┌────────────────────────────────┐ │
│  │                        │  │  コントロールパネル              │ │
│  │   プレビューエリア       │  │                                │ │
│  │   (選択した比率で表示)   │  │  📐 アスペクト比                │ │
│  │                        │  │  ┌────────────────────────┐   │ │
│  │                        │  │  │ ○ YouTube (16:9)       │   │ │
│  │   ▶ 再生ボタン          │  │  │ ○ Instagram投稿 (1:1)  │   │ │
│  │                        │  │  │ ○ Instagram投稿 (4:5)  │   │ │
│  │                        │  │  │ ○ リール/ストーリー(9:16)│   │ │
│  └────────────────────────┘  │  └────────────────────────┘   │ │
│                              │                                │ │
│                              │  🎬 FPS: [30fps ▼]             │ │
│                              │                                │ │
│                              │  [✨ 動画を生成] ボタン          │ │
│                              └────────────────────────────────┘ │
│                                                                  │
├──────────────────────────────────────────────────────────────────┤
│  音源エリア                                                       │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ 🎵 ドラッグ&ドロップ or クリックで音源をアップロード          │   │
│  │                                                          │   │
│  │ 波形表示:                                                 │   │
│  │ ┌────────────────────────────────────────────────────┐   │   │
│  │ │▼開始                                        ▼終了 │   │   │
│  │ │  ████████████████████████████████████████████████ │   │   │
│  │ │  0:00      0:30      1:00      1:30      2:00     │   │   │
│  │ └────────────────────────────────────────────────────┘   │   │
│  │                                                          │   │
│  │ 動画の長さ: [0:15] 〜 [1:45]  = 1分30秒                   │   │
│  └──────────────────────────────────────────────────────────┘   │
├──────────────────────────────────────────────────────────────────┤
│  画像エリア                                                       │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ 📷 ドラッグ&ドロップ or クリックで画像をアップロード          │   │
│  │                                                          │   │
│  │ [img1] [img2] [img3] [img4] [img5] [+追加]               │   │
│  │  ↕ ドラッグで並び替え可能                                  │   │
│  └──────────────────────────────────────────────────────────┘   │
├──────────────────────────────────────────────────────────────────┤
│  タイムライン（分析後表示）                                         │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ |img1[zoom]|--fade--|img2[pan]|--cut--|img3[static]|...  │   │
│  │ ════════════════════════════════════════════════════════ │   │
│  │ 0:00        0:30        1:00        1:30                 │   │
│  └──────────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────────┘
```

### 6.2 ステータス表示

- アップロード中: プログレスバー
- 分析中: 各画像/音源の分析進捗
- 生成中: レンダリング進捗
- エラー: 明確なエラーメッセージと対処法

---

## 7. 開発フェーズ

### Phase 1: プロジェクト基盤 (Week 1)

- [ ] Next.js + Tailwind セットアップ
- [ ] プロジェクト構造作成
- [ ] Supabase プロジェクト作成・接続
- [ ] 基本的なページルーティング

### Phase 2: 認証システム (Week 1-2)

- [ ] Supabase Auth 設定
- [ ] ログイン/サインアップ UI
- [ ] Google OAuth 連携
- [ ] 認証状態管理（Context/Hook）
- [ ] 保護されたルート実装

### Phase 3: コア UI (Week 2-3)

- [ ] 画像アップロード UI（ドラッグ&ドロップ）
- [ ] 音源アップロード UI
- [ ] 波形表示（wavesurfer.js）
- [ ] 範囲選択スライダー（動画長さ設定）
- [ ] アスペクト比選択 UI
- [ ] 画像並び替え機能

### Phase 4: AI 分析機能 (Week 3-4)

- [ ] API Route: Claude API 中継エンドポイント
- [ ] 画像分析機能実装
- [ ] 音源分析機能（Meyda.js + Claude）
- [ ] ビート検出アルゴリズム
- [ ] 分析結果の状態管理

### Phase 5: 編集エンジン (Week 4-5)

- [ ] AI による編集計画生成
- [ ] タイムライン構築ロジック
- [ ] トランジション自動選択
- [ ] ケンバーンズ効果設定
- [ ] タイムライン UI 表示

### Phase 6: プレビュー・出力 (Week 5-6)

- [ ] Canvas/WebGL プレビュー実装
- [ ] リアルタイム再生機能
- [ ] FFmpeg.wasm 統合
- [ ] 動画エンコード・出力
- [ ] ダウンロード機能

### Phase 7: 決済システム (Week 6-7)

- [ ] Stripe アカウント設定
- [ ] 商品・価格設定（Stripe Dashboard）
- [ ] Checkout セッション API
- [ ] Webhook エンドポイント
- [ ] サブスクリプション状態管理
- [ ] プランに応じた機能制限

### Phase 8: 使用量管理 (Week 7)

- [ ] 使用量カウントロジック
- [ ] 月次リセット処理
- [ ] 制限到達時の UI 表示
- [ ] アップグレード誘導 UI

### Phase 9: PWA 対応 (Week 8)

- [ ] next-pwa 設定
- [ ] マニフェストファイル作成
- [ ] Service Worker 設定
- [ ] オフライン対応（必要な範囲で）
- [ ] インストールプロンプト

### Phase 10: 仕上げ・リリース準備 (Week 8-9)

- [ ] エラーハンドリング強化
- [ ] ローディング・進捗表示改善
- [ ] レスポンシブ対応確認
- [ ] パフォーマンス最適化
- [ ] Vercel デプロイ設定
- [ ] 本番環境テスト
- [ ] 利用規約・プライバシーポリシー

### マイルストーン

```
Week 1-2:  認証付きの空のアプリが動く
Week 3-4:  ファイルアップロード + AI分析が動く
Week 5-6:  動画生成・ダウンロードが動く（機能完成）
Week 7-8:  決済・使用量制限が動く（収益化準備完了）
Week 9:    リリース 🚀
```

---

## 8. 制約事項・注意点

### 8.1 技術的制約

- FFmpeg.wasm はメモリ消費が大きい（長い動画は分割処理が必要）
- Claude API の画像分析は Base64 送信のためサイズ制限あり
- ブラウザのメモリ制限に注意（大量の大きな画像）

### 8.2 コスト考慮

- Claude API 呼び出し回数の最適化
  - 画像はバッチ処理で分析
  - キャッシュ活用

### 8.3 対応ブラウザ

- Chrome 90+
- Firefox 88+
- Safari 15+
- Edge 90+

---

## 9. 用語定義

| 用語           | 定義                                       |
| -------------- | ------------------------------------------ |
| ビート         | 音楽のリズムの基本単位、拍                 |
| BPM            | Beats Per Minute、1 分あたりの拍数         |
| トランジション | 画像間の切り替え効果                       |
| クリップ       | タイムライン上の 1 つの画像表示区間        |
| セクション     | 音楽の構造的な区切り（イントロ、サビなど） |
| ハイライト     | 音楽の中で特に印象的な瞬間                 |

---

## 10. チャット引き継ぎプロトコル

### 10.1 引き継ぎ時の必須情報

新しいチャットを開始する際は、以下を冒頭に貼り付けてください：

```
【プロジェクト引き継ぎ: AI Auto Video Generator】

■ 仕様書バージョン: 0.3.0
■ 現在のフェーズ: Phase X（例: Phase 3: コアUI）
■ 完了済みタスク:
  - [x] タスク1
  - [x] タスク2

■ 進行中/未完了タスク:
  - [ ] タスク3（進行中: 50%）
  - [ ] タスク4

■ 既知の問題/バグ:
  - 問題1の説明
  - 問題2の説明

■ 最新ソースコードのパス:
  /mnt/user-data/outputs/ai-video-generator/

■ 直前の作業内容:
  （例: 画像アップロードコンポーネントを作成中、エラーが発生）

■ 次にやるべきこと:
  （例: エラーを修正して、音源アップロードに進む）
```

### 10.2 ソースコード管理

```
プロジェクトルート: /home/claude/ai-video-generator/
出力先（ダウンロード用）: /mnt/user-data/outputs/ai-video-generator/

主要ファイル構成（予定）:
ai-video-generator/
├── app/
│   ├── page.tsx              # メインページ
│   ├── layout.tsx            # レイアウト
│   ├── login/page.tsx        # ログインページ
│   ├── dashboard/page.tsx    # ダッシュボード
│   └── api/
│       ├── analyze/route.ts  # AI分析API
│       ├── stripe/route.ts   # 決済API
│       └── usage/route.ts    # 使用量API
├── components/
│   ├── ImageUploader.tsx
│   ├── AudioUploader.tsx
│   ├── Timeline.tsx
│   ├── Preview.tsx
│   └── ...
├── lib/
│   ├── supabase.ts           # Supabase クライアント
│   ├── stripe.ts             # Stripe 設定
│   └── claude.ts             # Claude API
├── hooks/
│   ├── useAuth.ts
│   └── useVideoGenerator.ts
└── types/
    └── index.ts
```

### 10.3 バージョン管理ルール

仕様変更時は必ず以下を更新：

1. この仕様書の「バージョン」と「最終更新」
2. 変更履歴セクションに追記
3. 引き継ぎテンプレートのバージョン番号

---

## 11. 変更履歴

| 日付       | バージョン | 変更内容                                                                                                                                                                                  |
| ---------- | ---------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2025-12-31 | 0.1.0      | 初版作成                                                                                                                                                                                  |
| 2025-12-31 | 0.2.0      | アスペクト比オプション追加（Instagram 対応）、動画長さ選択機能追加、ケンバーンズ効果追加、トランジション拡張設計追加                                                                      |
| 2025-12-31 | 0.3.0      | 収益化対応（Option 1: Web MVP + PWA）: 料金プラン追加、Next.js + Supabase + Stripe 構成に変更、認証・決済システム追加、データベース設計追加、開発フェーズ詳細化（10 フェーズ、約 9 週間） |

---

## 12. 次のステップ

### 開発開始の準備

1. ✅ 仕様書 v0.3.0 完成
2. ⬜ 外部サービスのアカウント準備
   - [ ] Supabase アカウント作成
   - [ ] Stripe アカウント作成
   - [ ] Anthropic API キー取得（お持ちであれば確認）
   - [ ] Vercel アカウント作成（デプロイ用）
3. ⬜ Phase 1 開発開始

### 今すぐ始める場合

「Phase 1 を始めましょう」と伝えてください。
Next.js プロジェクトのセットアップから開始します。
